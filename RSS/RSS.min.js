var RiseVision=RiseVision||{};RiseVision.RSS={};RiseVision.RSS.Settings={};RiseVision.RSS.Controller={};RiseVision.RSS.Settings=function(){this.settings=new RiseVision.Common.Settings};
RiseVision.RSS.Settings.prototype.initSettings=function(){var a=this;$(".colorPicker").click(function(){rssSettings.showColorPicker($(this).data("for"))});$(".fontSelector").click(function(){rssSettings.showFontSelector($(this).data("for"))});$("input:checkbox").change(function(){"author"==$(this).val()?$(this).is(":checked")?$("li.author").show():$("li.author").hide():"date"==$(this).val()&&($(this).is(":checked")?$("li.date").show():$("li.date").hide())});$("input[name='layout']").change(function(){var a=
$(this).val();!$("#scrollDirection").is(":visible")||"ltr"!=$("#scrollDirection").val()&&"rtl"!=$("#scrollDirection").val()?$(this).is(":checked")&&("4x1-headline.xml"==a||"2x1-headline.xml"==a||"1x2-headline.xml"==a||"custom"==a?($("li.headline").show(),$("li.story").show(),$("li.media").show()):"4x1-no-image.xml"==a?($("li.headline").show(),$("li.story").show(),$("li.media").hide()):"4x1-no-headline.xml"==a||"2x1-no-headline.xml"==a||"1x2-no-headline.xml"==a?($("li.headline").hide(),$("li.story").show(),
$("li.media").show()):"4x1-no-image-no-headline.xml"==a?($("li.headline").hide(),$("li.story").show(),$("li.media").hide()):($("li.headline").hide(),$("li.story").hide(),$("li.media").show())):($("li.headline").show(),$("li.story").show(),$("li.media").hide())});$("#transition").change(function(){"continuous"==$(this).val()||"page"==$(this).val()&&("ltr"==$("#scrollDirection").val()||"rtl"==$("#scrollDirection").val())?$("li.transitionHold").hide():$("li.transitionHold").show();if("fade"!=$(this).val()&&
"none"!=$(this).val()){if($("li.transition").show(),"item"==$(this).val()||"continuous"==$(this).val()?$("li.separator").show():$("li.separator").hide(),"ltr"==$("#scrollDirection").val()||"rtl"==$("#scrollDirection").val())$("li.itemsCount").hide(),$("li.layout").hide()}else $("li.itemsCount").show(),$("li.transition").hide(),$("li.layout").show();$("input[name='layout']").trigger("change");a.setSeparatorVisibility()});$("#scrollDirection").change(function(){!$(this).is(":visible")||"ltr"!=$(this).val()&&
"rtl"!=$(this).val()?($("li.itemsCount").show(),$("li.layout").show(),$("li.media").show(),$("li.headlineColor").show(),$("li.storyColor").show(),$("li.authorColor").show(),$("li.dateColor").show(),"continuous"!=$("#transition").val()&&$("li.transitionHold").show()):($("li.itemsCount").hide(),$("li.layout").hide(),$("li.media").hide(),$("li.headlineColor").hide(),$("li.storyColor").hide(),$("li.authorColor").hide(),$("li.dateColor").hide(),"page"==$("#transition").val()&&$("li.transitionHold").hide());
$("input[name='layout']").trigger("change");a.setSeparatorVisibility()});$("#separator").change(function(){$(this).is(":visible")&&$(this).is(":checked")?$("li.separatorDetails").show():$("li.separatorDetails").hide()});gadgets.rpc.call("","rscmd_getAdditionalParams",function(b){if(b){var c=new gadgets.Prefs;b=JSON.parse(b);$("#url").val(c.getString("url"));$("#queue").val(c.getString("queue"));$("#itemsCount").val(c.getString("itemsCount"));$("#transition").val(c.getString("transition"));$("#scrollDirection").val(c.getString("scrollDirection"));
$("#scrollSpeed").val(c.getString("scrollSpeed"));$("#separator").attr("checked",c.getBool("separator"));$("#separatorColor").val(c.getString("separatorColor"));$("#separatorSize").val(c.getString("separatorSize"));$("#transitionHold").val(c.getString("transitionHold"));$("#transitionResumes").val(c.getString("transitionResumes"));$("#bgColor").val(c.getString("bgColor"));$("input[type='radio'][name='contentType']").each(function(){$(this).val()==c.getString("contentType")&&$(this).attr("checked",
"checked")});$("#author").attr("checked",c.getBool("author"));$("#date").attr("checked",c.getBool("date"));$("input[type='radio'][name='layout']").each(function(){$(this).val()==c.getString("layout")&&$(this).attr("checked","checked")});$("#layoutURL").val(c.getString("layoutURL"));c.getBool("separator")&&$("li.separatorDetails").show();a.populateColor($("#separatorColor"),c.getString("separatorColor"));a.populateColor($("#bgColor"),c.getString("bgColor"));a.populateColor($("#headlineColor"),b.headlineColor);
a.populateColor($("#storyColor"),b.storyColor);a.populateColor($("#authorColor"),b.authorColor);a.populateColor($("#dateColor"),b.dateColor);$("#headline_font-style").text(b.headline_font);$("#headline_font-style").data("css",b["headline_font-style"]);$("#headlinePadding").val(b.headlinePadding);$("#headlineColor").val(b.headlineColor);$("#story_font-style").text(b.story_font);$("#story_font-style").data("css",b["story_font-style"]);$("#storyPadding").val(b.storyPadding);$("#storyColor").val(b.storyColor);
$("#mediaPadding").val(b.mediaPadding);$("#author_font-style").text(b.author_font);$("#author_font-style").data("css",b["author_font-style"]);$("#authorPadding").val(b.authorPadding);$("#authorColor").val(b.authorColor);$("#date_font-style").text(b.date_font);$("#date_font-style").data("css",b["date_font-style"]);$("#datePadding").val(b.datePadding);$("#dateColor").val(b.dateColor)}$("form ol li ol.drillDown li:visible:last").css({clear:"left","float":"left","margin-bottom":"10px"});$("#settings").show();
$("input:checkbox").trigger("change");$("#transition").trigger("change");$("#scrollDirection").trigger("change")})};RiseVision.RSS.Settings.prototype.setSeparatorVisibility=function(){"up"!=$("#scrollDirection").val()&&"down"!=$("#scrollDirection").val()||"item"!=$("#transition").val()&&"continuous"!=$("#transition").val()?$("li.separator").hide():$("li.separator").show();$("#separator").trigger("change")};
RiseVision.RSS.Settings.prototype.populateColor=function(a,b){a.val(b);a.css("background-color",b)};RiseVision.RSS.Settings.prototype.showColorPicker=function(a){gadgets.rpc.call("","rscmd_openColorPicker",null,a,$("#"+a).val())};RiseVision.RSS.Settings.prototype.showFontSelector=function(a){gadgets.rpc.call("","rscmd_openFontSelector",null,a,$("#"+a).data("css"))};RiseVision.RSS.Settings.prototype.setColor=function(a,b){$("#"+a).val(b);$("#"+a).css("background-color",b)};
RiseVision.RSS.Settings.prototype.setFont=function(a,b,c){$("#"+a).data("css",b);$("#"+a).text(c)};
RiseVision.RSS.Settings.prototype.getSettings=function(){var a=!1,b=document.getElementsByClassName("errors")[0],c="",d=null,e;$(".errors").empty();$(".errors").css({display:"none"});if(""!=$("#url").val){var f=new google.feeds.Feed($("#url").val());f.setNumEntries(1);f.load(function(f){f.error&&(b.innerHTML+="RSS URL is invalid.<br />",a=!0);a=rssSettings.settings.validateRequired($("#url"),b,"RSS URL")?!0:a;a=rssSettings.settings.validateRequired($("#queue"),b,"Queue")?!0:a;a=rssSettings.settings.validateNumeric($("#queue"),
b,"Queue")?!0:a;0>=parseInt($("#queue").val())&&(b.innerHTML+="Queue must be greater than 0.<br />",a=!0);a=rssSettings.settings.validateRequired($("#itemsCount"),b,"Items Count")?!0:a;a=rssSettings.settings.validateNumeric($("#itemsCount"),b,"Items Count")?!0:a;$("#itemsCount").is(":visible")&&0>=parseInt($("#itemsCount").val())&&(b.innerHTML+="Items Count must be greater than 0.<br />",a=!0);$("#separatorSize").is(":visible")&&(a=rssSettings.settings.validateNumeric($("#separatorSize"),b,"Separator Size")?
!0:a);a=rssSettings.settings.validateRequired($("#transitionHold"),b,"Transition Hold")?!0:a;a=rssSettings.settings.validateNumeric($("#transitionHold"),b,"Transition Hold")?!0:a;$("#transitionHold").is(":visible")&&0>=parseInt($("#transitionHold").val())&&(b.innerHTML+="Transition Hold must be greater than 0.<br />",a=!0);a=rssSettings.settings.validateRequired($("#transitionResumes"),b,"Transition Resumes")?!0:a;a=rssSettings.settings.validateNumeric($("#transitionResumes"),b,"Transition Resumes")?
!0:a;$("#transitionResumes").is(":visible")&&0>=parseInt($("#transitionResumes").val())&&(b.innerHTML+="Transition Resumes must be greater than 0.<br />",a=!0);a=rssSettings.settings.validateNumeric($("#headlinePadding"),b,"Headline Padding")?!0:a;a=rssSettings.settings.validateNumeric($("#storyPadding"),b,"Summary / Story Padding")?!0:a;a=rssSettings.settings.validateNumeric($("#mediaPadding"),b,"Media Padding")?!0:a;a=rssSettings.settings.validateNumeric($("#authorPadding"),b,"Author Padding")?
!0:a;a=rssSettings.settings.validateNumeric($("#datePadding"),b,"Date Padding")?!0:a;"custom"==$("input[type='radio'][name='layout']:checked").val()&&(a=rssSettings.settings.validateRequired($("#layoutURL"),b,"Layout URL")?!0:a);if(a)return $(".errors").fadeIn(200).css("display","inline-block"),$("#wrapper").scrollTop(0),null;c="up_url="+escape($("#url").val())+"&up_queue="+$("#queue").val()+"&up_itemsCount="+$("#itemsCount").val()+"&up_transition="+$("#transition").val()+"&up_scrollDirection="+$("#scrollDirection").val()+
"&up_scrollSpeed="+$("#scrollSpeed").val();c+="&up_separatorColor="+$("#separatorColor").val()+"&up_separatorSize="+$("#separatorSize").val()+"&up_transitionHold="+$("#transitionHold").val()+"&up_transitionResumes="+$("#transitionResumes").val()+"&up_bgColor="+$("#bgColor").val();c+=$("#separator").is(":checked")?"&up_separator=true":"&up_separator=false";e=$("input[type='radio'][name='contentType']:checked");0<e.length&&(c+="&up_contentType="+e.val());c+=$("#author").is(":checked")?"&up_author=true":
"&up_author=false";c+=$("#date").is(":checked")?"&up_date=true":"&up_date=false";e=$("input[type='radio'][name='layout']:checked");0<e.length&&(c+="&up_layout="+e.val());c+="&up_layoutURL="+$("#layoutURL").val();d={params:c,additionalParams:JSON.stringify(rssSettings.saveAdditionalParams())};gadgets.rpc.call("","rscmd_saveSettings",null,d)})}};
RiseVision.RSS.Settings.prototype.saveAdditionalParams=function(){var a={};a.headline_font=$("#headline_font-style").text();a["headline_font-style"]=$("#headline_font-style").data("css");a.headlinePadding=""==$("#headlinePadding").val()?0:$("#headlinePadding").val();a.headlineColor=$("#headlineColor").val();a.story_font=$("#story_font-style").text();a["story_font-style"]=$("#story_font-style").data("css");a.storyPadding=""==$("#storyPadding").val()?0:$("#storyPadding").val();a.storyColor=$("#storyColor").val();
a.mediaPadding=""==$("#mediaPadding").val()?0:$("#mediaPadding").val();a.author_font=$("#author_font-style").text();a["author_font-style"]=$("#author_font-style").data("css");a.authorPadding=""==$("#authorPadding").val()?0:$("#authorPadding").val();a.authorColor=$("#authorColor").val();a.date_font=$("#date_font-style").text();a["date_font-style"]=$("#date_font-style").data("css");a.datePadding=""==$("#datePadding").val()?0:$("#datePadding").val();a.dateColor=$("#dateColor").val();return a};
RiseVision.RSS.Controller=function(){this.isFeedLoaded=!1;this.imageCount=this.nextItemIndex=this.currentItemIndex=0;this.feedLoadFailedInterval=5E3;this.refreshInterval=6E4;this.images=[];this.layout=prefs.getString("layout");this.itemsCount=prefs.getInt("itemsCount");this.transition=prefs.getString("transition");this.transitionHold=1E3*prefs.getInt("transitionHold");this.transitionResumes=1E3*prefs.getInt("transitionResumes");this.scrollDirection=prefs.getString("scrollDirection");this.startTimeout=
new Date;this.timeLeft=0;this.isLoading=!0;this.isFadingOut=this.isFadingIn=this.isDone=this.isPaused=this.isPlaying=!1;this.supportedImages=["image/bmp","image/gif","image/jpeg","image/png","image/tiff"];this.supportedVideos=["video/mp4","video/webm","video/ogg"];this.util=RiseVision.Common.Utility;"custom"==prefs.getString("layout")?this.layoutURL=prefs.getString("layoutURL"):this.layoutURL="https://s3.amazonaws.com/Gadget-RSS/layouts/"+prefs.getString("layout");"4x1-no-image-no-headline"==prefs.getString("layout")||
"4x1-no-image"==prefs.getString("layout")?this.isMediaLayout=!1:this.isMediaLayout=!0};
RiseVision.RSS.Controller.prototype.getAdditionalParams=function(a,b){if("additionalParams"==a&&b){var c=document.createElement("style");b=JSON.parse(b);c.appendChild(document.createTextNode(b["headline_font-style"]));c.appendChild(document.createTextNode("a:active"+b["headline_font-style"]));c.appendChild(document.createTextNode("a:visited"+b["headline_font-style"]));c.appendChild(document.createTextNode(b["story_font-style"]));c.appendChild(document.createTextNode(b["author_font-style"]));c.appendChild(document.createTextNode(b["date_font-style"]));
document.getElementsByTagName("head")[0].appendChild(c);controller.headlinePadding=parseInt(b.headlinePadding);controller.headlineColor=b.headlineColor;controller.storyPadding=parseInt(b.storyPadding);controller.storyColor=b.storyColor;controller.mediaPadding=parseInt(b.mediaPadding);controller.authorPadding=parseInt(b.authorPadding);controller.authorColor=b.authorColor;controller.datePadding=parseInt(b.datePadding);controller.dateColor=b.dateColor}controller.initialize()};
RiseVision.RSS.Controller.prototype.initialize=function(){var a=this,b={};this.layoutURL&&(b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,gadgets.io.makeRequest(this.layoutURL,function(c){c=c.data;if(0<c.getElementsByTagName("Style").length){var d=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css";e.innerHTML=c.getElementsByTagName("Style")[0].childNodes[1].nodeValue;d.appendChild(e)}0!=c.getElementsByTagName("Layout").length&&(a.item=
c.getElementsByTagName("Layout")[0].childNodes[1].nodeValue,b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM,b[gadgets.io.RequestParameters.REFRESH_INTERVAL]=60,gadgets.io.makeRequest(prefs.getString("url"),function(b){a.onFeedLoaded(b)},b))},b))};
RiseVision.RSS.Controller.prototype.loadFeed=function(){var a=this,b={},c=prefs.getString("url");this.feedLoadFailedTimer=setTimeout(function(){a.feedLoadFailed()},this.feedLoadFailedInterval);b[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.DOM;b[gadgets.io.RequestParameters.REFRESH_INTERVAL]=60;gadgets.io.makeRequest(c,function(b){0!=b.errors.length||a.isFeedLoaded||(clearTimeout(a.feedLoadFailedTimer),a.onFeedLoaded(b))},b)};
RiseVision.RSS.Controller.prototype.onFeedLoaded=function(a){var b=prefs.getInt("queue"),c;this.isFeedLoaded=!0;for(var d=a.data.getElementsByTagName("item").length-1;d>=b;d--)c=a.data.getElementsByTagName("item")[d],c.parentNode.removeChild(c);a.data&&0<a.data.getElementsByTagName("item").length?this.showFeed(a):(console.log("This feed has no items."),readyEvent())};
RiseVision.RSS.Controller.prototype.feedLoadFailed=function(){this.isFeedLoaded=!0;"fade"==this.transition?(this.isFadingOut=this.isFadingIn=!1,this.isPaused||this.showItem()):"none"==this.transition&&(this.isPaused||this.showItem())};
RiseVision.RSS.Controller.prototype.showFeed=function(a){var b=[];if(this.isHorizontal())if(this.isLoading){this.feedData=a.data;this.items=this.feedData.getElementsByTagName("item");$("#hiddenContainer").remove();$("#container").remove();for(a=0;a<this.items.length;a++)b.push(this.getHorizontalScrollData(this.items[a]));a={width:prefs.getInt("rsW"),height:prefs.getInt("rsH"),scrollBy:this.transition,scrollDirection:this.scrollDirection,speed:prefs.getString("scrollSpeed"),duration:this.transitionHold,
interactivityTimeout:this.transitionResumes};this.horizontalScroll=new RiseVision.Common.HorizontalScroll(a,b);$(this.horizontalScroll).bind({done:function(){doneEvent()}});readyEvent()}else this.oldData=this.feedData,this.feedData=a.data,this.items=this.feedData.getElementsByTagName("item"),this.updateHorizontalScrollData();else null!=this.feedData&&(this.oldData=this.feedData),this.feedData=a.data,this.items=this.feedData.getElementsByTagName("item"),this.imageURLs=[],this.videos=[],this.isMediaLayout&&
this.getMedia(),this.hasImage()&&this.isMediaLayout?this.preloadImages():"fade"==this.transition?(this.isFadingOut=this.isFadingIn=!1,this.isLoading?this.init():this.showItem()):"none"==this.transition?this.isLoading?this.init():this.showItem():this.isLoading?this.init():this.updateVerticalScrollData()};
RiseVision.RSS.Controller.prototype.init=function(){var a=this;this.playlists=[];$("#container").width(prefs.getString("rsW"));$("#container").height(prefs.getString("rsH"));"fade"==this.transition||"none"==this.transition?($(".page").bind({touchstart:function(b){clearTimeout(a.showFeedTimer);a.showFeedTimer=setTimeout(function(){a.showNext()},a.transitionResumes)}}),this.addItems(),$(".item").each(function(b){a.nextItemIndex<a.items.length&&(a.populateItem(a.items[a.nextItemIndex],b,a.nextItemIndex),
a.nextItemIndex++)})):(this.showAllItems(),$(".item").height(this.getItemHeight()));if(this.isLoading){if(0<this.videos.length&&("fade"==this.transition||"none"==this.transition)){for(var b=0;b<this.videos.length;b++)null!=this.videos[b]&&this.playlists.push({sources:[{file:this.videos[b].url,type:"video/quicktime"==this.videos[b].type?"mp4":""}]});0<this.playlists.length?$(".video").each(function(b){a.videosLoaded=0;$(this).attr("id","video"+b);a.initPlayer(b)}):readyEvent()}else 0<this.videos.length&&
(console.log("Videos are only supported for the Fade and None transitions."),$(".videoWrapper").hide()),readyEvent();"fade"!=this.transition&&"none"!=this.transition&&$("#container").infiniteScroll({direction:this.scrollDirection,scrollBy:this.transition,duration:this.transitionHold,speed:prefs.getString("scrollSpeed"),swipingTimeout:this.transitionResumes}).bind("onLastItemScrolled",function(a){doneEvent()})}};
RiseVision.RSS.Controller.prototype.addItems=function(){if(0==this.playlists.length){$(".item").remove();for(var a=0;a<this.itemsCount;a++)$(".page").append(this.item);this.applyStyle();$(".item").height(this.getItemHeight())}};
RiseVision.RSS.Controller.prototype.initPlayer=function(a){var b=this;this.dimensions=this.getMediaDimensions(a,this.videos[a]);jwplayer("video"+a).setup({playlist:this.playlists,width:this.dimensions.width,height:this.dimensions.height,primary:"flash",controls:!1,mute:!1});jwplayer("video"+a).onReady(function(){var a;b.isLoading?(b.videosLoaded++,b.videosLoaded==$(".videoWrapper").length&&(a=b.currentItemIndex,$(".videoWrapper").each(function(b){jwplayer(b).playlistItem(a);jwplayer(b).play(!1);a++}),
readyEvent())):(a=b.currentItemIndex,$(".videoWrapper").each(function(b){jwplayer(b).playlistItem(a);0<b&&jwplayer(b).play(!1);a++}))});jwplayer("video"+a).onPause(function(a){var d=this;"BUFFERING"==a.oldstate||b.isPaused||(b.resumeVideoTimer=setTimeout(function(){d.play(!0)},b.transitionResumes))});jwplayer("video"+a).onComplete(function(a){var d=!1,e=b.currentItemIndex;if("fade"==b.transition||"none"==b.transition)$(".videoWrapper").each(function(a){"PLAYING"==jwplayer(a).getState()?d=!0:"IDLE"==
jwplayer(a).getState()&&(jwplayer(a).playlistItem(e),jwplayer(a).play(!1));e++}),d||b.showNext()});jwplayer("video"+a).onError(function(a){console.log(a)})};
RiseVision.RSS.Controller.prototype.applyStyle=function(){$(".headline").css({padding:this.headlinePadding,"background-color":this.headlineColor});$(".story").css({padding:this.storyPadding,"background-color":this.storyColor});$(".image, .videoWrapper").css({padding:this.mediaPadding});$(".author").css({padding:this.authorPadding,"background-color":this.authorColor});$(".date").css({padding:this.datePadding,"background-color":this.dateColor})};
RiseVision.RSS.Controller.prototype.getMedia=function(){for(var a=this.feedData.getElementsByTagName("item").length,b,c,d,e,f,m=0;m<a;m++){f=!1;b=this.items[m];story=this.getStory(b);c=this.util.getElementByNodeName(b,"media:content");d=b.getElementsByTagName("enclosure");if(null!=c)if(d=c[0].getAttribute("medium"),b=c[0].getAttribute("url"),e=c[0].getAttribute("type"),null!=d)"image"==d?this.urlExists(b,story)||(this.imageURLs.push(b),f=!0):"video"!=d||this.urlExists(b,story)||(this.videos.push({url:b,
type:e,width:c[0].getAttribute("width"),height:c[0].getAttribute("height"),position:0}),f=!0);else{if(null!=e){for(var k in this.supportedImages)if(e==this.supportedImages[k]){this.urlExists(b,story)||(this.imageURLs.push(b),f=!0);break}if(!f)for(k in this.supportedVideos)if(e==this.supportedVideos[k]){this.urlExists(b,story)||(this.videos.push({url:b,type:e,width:c[0].getAttribute("width"),height:c[0].getAttribute("height"),position:0}),f=!0);break}}}else if(null!=d&&0<d.length){b=d[0].getAttribute("url");
e=d[0].getAttribute("type");for(k in this.supportedImages)if(e==this.supportedImages[k]){this.urlExists(b,story)||(this.imageURLs.push(b),f=!0);break}if(!f)for(k in this.supportedVideos)if(e==this.supportedVideos[k]){this.urlExists(b,story)||(this.videos.push({url:b,type:e,position:0}),f=!0);break}}f||(this.imageURLs.push(null),this.videos.push(null))}};RiseVision.RSS.Controller.prototype.preloadImages=function(){var a=this.imageURLs.length;this.imageCount=0;this.images=[];this.loadImage(a)};
RiseVision.RSS.Controller.prototype.loadImage=function(a){var b=this,c;if(null==this.imageURLs[this.imageCount])this.onImageLoaded(null,a);else c=new Image,c.onload=function(){clearTimeout(b.feedLoadFailedTimer);b.onImageLoaded(c,a)},this.feedLoadFailedTimer=setTimeout(function(){b.feedLoadFailed()},this.feedLoadFailedInterval),c.src=this.imageURLs[this.imageCount]};
RiseVision.RSS.Controller.prototype.onImageLoaded=function(a,b){this.images.push(a);this.imageCount++;b--;0==b?this.isLoading?this.init():"fade"==this.transition?(this.isFadingOut=this.isFadingIn=!1,this.showItem()):"none"==this.transition?this.showItem():this.updateVerticalScrollData():this.loadImage(b)};
RiseVision.RSS.Controller.prototype.populateItem=function(a,b,c){var d=this.util.getNodeValue(a.getElementsByTagName("title")),e=this.getStory(a),f=this.util.getNodeValue(this.util.getElementByNodeName(a,"dc:creator"));a=this.util.getNodeValue(a.getElementsByTagName("pubDate"));""==d?$(".headline").eq(b).hide():($(".headline a").eq(b).html(d),$(".headline").eq(b).show());""!=e?("summary"==prefs.getString("contentType")?$(".story").eq(b).text(RiseVision.Common.Utility.truncate($("<div/>").html(RiseVision.Common.Utility.stripScripts(e)).text(),
120)):($(".story").eq(b).html(RiseVision.Common.Utility.stripScripts(e)),$(".story").find("p").addClass("story_font-style"),$(".story").find("div").addClass("story_font-style"),$(".story").find("span").addClass("story_font-style")),$(".story").eq(b).show()):$(".story").eq(b).hide();$(".separator").eq(b).show();prefs.getBool("author")&&""!=f?($(".author").eq(b).html(f),$(".author").eq(b).show()):($(".author").eq(b).hide(),$(".separator").eq(b).hide());prefs.getBool("date")&&""!=a?($(".date").eq(b).text((new Date(a)).toString("MMMM dS, yyyy")),
$(".date").eq(b).attr("datetime",(new Date(a)).toString("yyyy-MM-dd")),$(".date").eq(b).show()):($(".date").eq(b).hide(),$(".separator").eq(b).hide());this.showSeparator()&&$(".item").css("border-bottom","solid "+prefs.getInt("separatorSize")+"px "+prefs.getString("separatorColor"));null!=this.images[c]&&this.images[c].src?($(".videoWrapper").eq(b).hide(),$(".image").eq(b).attr("src",this.images[c].src),$(".image").eq(b).show(),this.getMediaDimensions(b,this.images[c],$("#container .image").eq(b))):
null!=this.videos[c]?($(".image").eq(b).hide(),$(".videoWrapper").eq(b).show(),this.isLoading||(jwplayer(b).playlistItem(c),jwplayer(b).play(!1))):($(".image").eq(b).hide(),$(".videoWrapper").eq(b).hide());("fade"!=this.transition&&"none"!=this.transition&&0==this.playlists.length||this.isLoading)&&$(".item").eq(b).dotdotdot({height:this.getItemHeight()})};
RiseVision.RSS.Controller.prototype.getMediaDimensions=function(a,b,c){var d={},e;$("#hiddenContainer").empty();$("#hiddenContainer").append($(".item").clone());"2x1-headline.xml"==prefs.getString("layout")||"2x1-no-headline.xml"==prefs.getString("layout")?(d.width=.5*prefs.getString("rsW"),d.height=prefs.getString("rsH")/this.itemsCount-$("#hiddenContainer .textWrapper").eq(a).outerHeight(!0)-2*this.mediaPadding,0==$("#hiddenContainer .story").eq(a).length&&"2x1-headline.xml"==prefs.getString("layout")&&
(d.width=prefs.getString("rsW")-2*this.mediaPadding)):"1x2-headline.xml"==prefs.getString("layout")||"1x2-no-headline.xml"==prefs.getString("layout")?(d.width=prefs.getString("rsW")-2*this.mediaPadding,d.height=(prefs.getString("rsH")/this.itemsCount-2*this.mediaPadding)/2):"4x1-headline.xml"==prefs.getString("layout")||"4x1-no-headline.xml"==prefs.getString("layout")?(d.width=.33*prefs.getString("rsW"),d.height=prefs.getString("rsH")/this.itemsCount-2*this.mediaPadding):"background.xml"==prefs.getString("layout")&&
(d.width=prefs.getString("rsW")-2*this.mediaPadding,d.height=prefs.getString("rsH")/this.itemsCount-prefs.getInt("separatorSize")-2*this.mediaPadding);$.isEmptyObject(d)||(a=d.width/parseInt(b.width),e=d.height/parseInt(b.height),a=a<e?a:e,d.width=parseInt(parseInt(b.width)*a),d.height=parseInt(parseInt(b.height)*a),null!=c&&(c.width(d.width),c.height(d.height)));$("#hiddenContainer").empty();return d};
RiseVision.RSS.Controller.prototype.getHorizontalScrollData=function(a){var b=[],c=!1,d=this.util.getNodeValue(a.getElementsByTagName("title")),e=this.getStory(a),f=this.util.getNodeValue(this.util.getElementByNodeName(a,"dc:creator"));a=this.util.getNodeValue(a.getElementsByTagName("pubDate"));for(var m,k,n,p,g=0;g<document.styleSheets[2].cssRules.length;g++){var l=document.styleSheets[2].cssRules[g].cssText;-1==l.indexOf("@font-face")&&(-1!=l.indexOf("headline_font-style")&&(m=document.styleSheets[2].cssRules[g].cssText),
-1!=l.indexOf("story_font-style")&&(k=document.styleSheets[2].cssRules[g].cssText),-1!=l.indexOf("author_font-style")&&(n=document.styleSheets[2].cssRules[g].cssText),-1!=l.indexOf("date_font-style")&&(p=document.styleSheets[2].cssRules[g].cssText))}""!=d&&b.push({type:"text",value:d,fontRule:m,padding:this.headlinePadding,background:prefs.getString("headlineColor")});prefs.getBool("author")&&""!=f&&(b.push({type:"text",value:f,fontRule:n,padding:this.authorPadding,background:prefs.getString("authorColor")}),
c=!0);prefs.getBool("date")&&""!=a&&(c&&b.push({type:"text",value:" - ",fontRule:n,padding:this.authorPadding,background:prefs.getString("dateColor")}),b.push({type:"text",value:(new Date(a)).toString("MMMM dS, yyyy"),fontRule:p,padding:this.datePadding,background:prefs.getString("dateColor")}));null!=e&&(e="summary"==prefs.getString("contentType")?RiseVision.Common.Utility.truncate($("<div/>").html(RiseVision.Common.Utility.stripScripts(e)).text(),120):RiseVision.Common.Utility.unescapeHTML(RiseVision.Common.Utility.stripScripts(e)),
b.push({type:"text",value:e,fontRule:k,padding:this.storyPadding,background:prefs.getString("storyColor")}));return b};
RiseVision.RSS.Controller.prototype.updateHorizontalScrollData=function(){var a=this,b=this.oldData.getElementsByTagName("item");null!=b&&null!=this.items&&(this.items.length!=b.length?$.each(this.items,function(b,d){a.updateItem(b,d)}):$.each(this.items,function(c,d){var e=b[c],f=!1;a.util.getNodeValue(d.getElementsByTagName("headline"))!=a.util.getNodeValue(e.getElementsByTagName("headline"))&&(f=!0);prefs.getBool("author")&&a.util.getNodeValue(d.getElementsByTagName("dc:creator"))!=a.util.getNodeValue(e.getElementsByTagName("dc:creator"))&&
(f=!0);prefs.getBool("date")&&a.util.getNodeValue(d.getElementsByTagName("pubDate"))!=a.util.getNodeValue(e.getElementsByTagName("pubDate"))&&(f=!0);a.util.getNodeValue(d.getElementsByTagName("description"))!=a.util.getNodeValue(e.getElementsByTagName("description"))&&(f=!0);f&&a.updateItem(c,d)}))};RiseVision.RSS.Controller.prototype.updateItem=function(a,b){var c=[],c=this.getHorizontalScrollData(b);this.horizontalScroll.updateItem(a,c)};
RiseVision.RSS.Controller.prototype.showAllItems=function(){for(var a=this.items.length,b=0;b<a;b++)$(".page").append(this.item);this.applyStyle();for(b=0;b<a;b++)this.populateItem(this.items[b],b,b)};
RiseVision.RSS.Controller.prototype.updateVerticalScrollData=function(){var a=this,b=this.oldData.getElementsByTagName("item"),c,d,e,f,m,k,n,p;$.each(this.items,function(g,l){c=b[g];d=a.util.getNodeValue(l.getElementsByTagName("link"));e=a.util.getNodeValue(l.getElementsByTagName("title"));f=a.getStory(l);m=a.util.getNodeValue(a.util.getElementByNodeName(l,"dc:creator"));k=a.util.getNodeValue(l.getElementsByTagName("pubDate"));n=a.util.getNodeValue(c.getElementsByTagName("link"));p=a.util.getNodeValue(c.getElementsByTagName("title"));
if(d!=n||e!=p){var h=$(".item").eq(g);h.find(".headline a").text(RiseVision.Common.Utility.unescapeHTML(e));h.find(".headline").show();""!=f?("summary"==prefs.getString("contentType")?h.find(".story").eq(g).text(RiseVision.Common.Utility.truncate($("<div/>").html(RiseVision.Common.Utility.stripScripts(f)).text(),120)):h.find(".story").eq(g).html(RiseVision.Common.Utility.stripScripts(f)),h.find(".story").eq(g).show()):h.find(".story").eq(g).hide();h.find(".separator").eq(g).show();prefs.getBool("author")&&
""!=m?(h.find(".author").eq(g).html(m),h.find(".author").eq(g).show()):(h.find(".author").eq(g).hide(),h.find(".separator").eq(g).hide());prefs.getBool("date")&&""!=k?(h.find(".date").eq(g).text((new Date(k)).toString("MMMM dS, yyyy")),h.find(".date").eq(g).attr("datetime",(new Date(k)).toString("yyyy-MM-dd")),h.find(".date").eq(g).show()):(h.find(".date").eq(g).hide(),h.find(".separator").eq(g).hide())}})};
RiseVision.RSS.Controller.prototype.showItem=function(){var a=this,b;this.items&&(this.currentItemIndex>=this.items.length?(this.nextItemIndex=this.currentItemIndex=this.timeLeft=0,this.isDone=!0,doneEvent()):this.isLoading?(b=this.hasVideo(this.currentItemIndex),"fade"==this.transition&&(this.transitionHold=1E3*prefs.getInt("transitionHold")-600),b||this.startTimer()):(b=this.hasVideo(this.currentItemIndex),this.addItems(),$(".item").each(function(b){a.nextItemIndex<a.items.length?(a.populateItem(a.items[a.nextItemIndex],
b,a.nextItemIndex),$(".item").eq(b).show()):$(".item").eq(b).hide();a.nextItemIndex++}),"fade"==this.transition?(this.transitionHold=1E3*prefs.getInt("transitionHold")-1200,this.isFadingIn||this.isFadingOut||(this.isFadingIn=!0,b||($("#container").css({visibility:"hidden"}),$(".item").dotdotdot({height:this.getItemHeight()}),$("#container").css({visibility:"visible"})),$("#container").fadeTo("slow",1,function(){a.isFadingIn=!1;a.isPaused||(b?jwplayer(0).playlistItem(a.currentItemIndex):a.startTimer())}))):
(b||$(".item").dotdotdot({height:this.getItemHeight()}),this.isPaused||(b?jwplayer(0).playlistItem(this.currentItemIndex):this.startTimer()))))};RiseVision.RSS.Controller.prototype.showNext=function(){"fade"==this.transition?this.fadeOut():this.transitionOut()};RiseVision.RSS.Controller.prototype.transitionOut=function(){var a=this;this.showFeedTimer=null;this.currentItemIndex=this.nextItemIndex;this.isPaused||setTimeout(function(){a.showItem.call(a)},1E3)};
RiseVision.RSS.Controller.prototype.fadeOut=function(){var a=this;this.isFadingIn||this.isFadingOut||(this.showFeedTimer=null,this.isFadingOut=!0,$("#container").fadeTo("slow",.01,function(){a.isFadingOut=!1;a.currentItemIndex=a.nextItemIndex;a.isPaused||a.showItem()}))};RiseVision.RSS.Controller.prototype.startTimer=function(){var a=this;clearTimeout(this.showFeedTimer);this.showFeedTimer=setTimeout(function(){a.showNext()},this.transitionHold);this.isPaused||(this.startTimeout=new Date)};
RiseVision.RSS.Controller.prototype.pauseTimer=function(){var a;this.isPlaying&&(clearTimeout(this.showFeedTimer),clearTimeout(this.resumeVideoTimer),$(".videoWrapper").each(function(a){$(this).is(":visible")&&jwplayer(a).play(!1)}),$(".item:first").is(":visible")&&(this.timeLeft=this.transitionHold,this.timeLeft-=new Date-this.startTimeout,a=Math.round(this.timeLeft/1E3),this.timeLeft=1E3*a,this.isDone||20<=prefs.getInt("transitionHold")&&10>=a))&&(this.timeLeft=0,this.isDone?this.isFeedLoaded?this.showItem():
this.loadFeed():this.showNext())};RiseVision.RSS.Controller.prototype.resumeTimer=function(){var a=this;this.hasVideo(this.currentItemIndex)?this.isDone?this.isDone=!1:(this.showItem(),jwplayer(0).play(!0)):this.isLoading?(this.timeLeft=this.transitionHold,this.isFeedLoaded?this.showItem():this.loadFeed()):(this.isDone&&(this.timeLeft=this.transitionHold,this.isDone=!1),clearTimeout(this.showFeedTimer),this.showFeedTimer=setTimeout(function(){a.showNext()},this.timeLeft))};
RiseVision.RSS.Controller.prototype.getStory=function(a){var b=this.util.getElementByNodeName(a,"content:encoded");null==b&&(b=this.util.getElementByNodeName(a,"description"));return this.util.getNodeValue(b)};RiseVision.RSS.Controller.prototype.getItemHeight=function(){return this.showSeparator()?prefs.getInt("rsH")/this.itemsCount-prefs.getInt("separatorSize"):prefs.getInt("rsH")/this.itemsCount};RiseVision.RSS.Controller.prototype.expireUpdatesTimer=function(){this.refresh=!0};
RiseVision.RSS.Controller.prototype.isHorizontal=function(){return"fade"!=this.transition&&"none"!=this.transition?"ltr"==this.scrollDirection||"rtl"==this.scrollDirection:!1};RiseVision.RSS.Controller.prototype.showSeparator=function(){return!prefs.getBool("separator")||"item"!=this.transition&&"continuous"!=this.transition||"up"!=this.scrollDirection&&"down"!=this.scrollDirection?!1:!0};
RiseVision.RSS.Controller.prototype.hasImage=function(){if(0<this.imageURLs.length)for(var a=0;a<this.imageURLs.length;a++)if(null!=this.imageURLs[a])return!0;return!1};RiseVision.RSS.Controller.prototype.hasVideo=function(a){if(this.videos)return 0<this.videos.length&&0<$(".videoWrapper").length?null!=this.videos[a]?!0:!1:!1};RiseVision.RSS.Controller.prototype.urlExists=function(a,b){return null!=a&&null!=b?-1==b.indexOf(a)?!1:!0:!1};
RiseVision.RSS.Controller.prototype.play=function(){var a=this;this.isPlaying=!0;"fade"==this.transition||"none"==this.transition?(this.resumeTimer(),this.isPaused=!1):this.isHorizontal()?(this.isLoading&&setTimeout(function(){a.horizontalScroll.initialize();a.horizontalScroll.tick()},3E3),this.isPaused&&(this.horizontalScroll.tick(),this.isPaused=!1)):(this.isPaused=!1,$("#container").infiniteScroll.start());this.isLoading&&(this.isLoading=!1,setInterval(function(){a.isFeedLoaded=!1;"fade"!=a.transition&&
"none"!=a.transition&&a.loadFeed()},this.refreshInterval))};RiseVision.RSS.Controller.prototype.pause=function(){"fade"==this.transition||"none"==this.transition?this.pauseTimer():this.isHorizontal()?this.horizontalScroll.pause():$("#container").infiniteScroll.pause();this.isPaused=!0};